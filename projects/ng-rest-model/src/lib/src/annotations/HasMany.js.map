{"version":3,"file":"HasMany.js","sourceRoot":"","sources":["HasMany.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,4DAAyD;AACzD,0CAAkE;AAClE,0CAA8C;AAU9C,iBACI,KAA6B,EAC7B,IAA+B,EAC/B,KAAkB,EAClB,KAAc,EACd,KAAe;IAEf,IAAI,MAAqB,CAAC;IAC1B,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC;QAC5B,MAAM,GAAG;YACL,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,KAAK,EAAE,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK;YACjC,KAAK,EAAE,KAAK,CAAC,KAAK,IAAI,iBAAS,CAAC,IAAI;YACpC,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK;YACpB,KAAK,EAAE,KAAK,CAAC,KAAK;SACrB,CAAC;IACN,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,MAAM,GAAG;YACL,KAAK,EAAE,KAAK,IAAI,KAAK;YACrB,KAAK,EAAE,KAAK,IAAI,iBAAS,CAAC,IAAI;YAC9B,KAAK,EAAE,CAAC,CAAC,KAAK;YACd,IAAI,EAAE,IAAI;YACV,KAAK,EAAE,KAAK;SACf,CAAC;IACN,CAAC;IACD,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,KAAK,iBAAS,CAAC,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC;IAE/D,MAAM,CAAC,UAA+C,MAAS,EAAE,WAAmB;QAChF,EAAE,CAAC,CAAC,OAAO,MAAM,KAAK,UAAU,CAAC,CAAC,CAAC;YAC/B,MAAM,IAAI,KAAK,CACX,2EAA2E;iBAC3E,aAAW,oBAAY,CAAC,MAAM,CAAC,oBAAe,WAAa,CAAA,CAC9D,CAAC;QACN,CAAC;QAED,EAAE,CAAC,CAAC,CAAC,iBAAS,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACnC,MAAM,IAAI,KAAK,CACX,wEAAwE;iBACxE,UAAQ,oBAAY,CAAC,MAAM,CAAC,0BAAuB,CAAA,CACtD,CAAC;QACN,CAAC;QAED,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;YACf,MAAM,IAAI,KAAK,CACX,wCAAwC;iBACxC,aAAW,oBAAY,CAAC,MAAM,CAAC,iBAAY,MAAM,CAAC,KAAO,CAAA,CAC5D,CAAC;QACN,CAAC;QAED,MAAM;YAAe,2BAAM;YASvB;gBAAY,cAAc;qBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;oBAAd,yBAAc;;gBAA1B,+BACa,IAAI,UAGhB;gBAFG,IAAM,QAAQ,GAAG,KAAI,CAAC,UAAU,CAAC,CAAC;gBAClC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,+BAAc,CAAM,KAAI,EAAE,MAAM,CAAC,CAAC;;YACnE,CAAC;YAZD,sBAAI,mBAAC,MAAM,CAAC,KAAM;qBAAlB;oBACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC;gBAC/C,CAAC;;;eAAA;YAED,sBAAI,mBAAC,MAAM,CAAC,KAAM;qBAAlB,UAAmB,KAAY;oBAC3B,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAClD,CAAC;;;eAAA;YAOL,cAAC;QAAD,CAAC,AAdM,CAAc,MAAM,GAczB;IACN,CAAC,CAAC;AACN,CAAC;AAjED,0BAiEC","sourcesContent":["import {HasManyHandler} from '../classes/HasManyHandler';\nimport {FetchMode, RestModel, TFetchMode} from '../classes/index';\nimport {getClassName} from '../helpers/index';\n\nexport interface HasManyConfig<T = any> {\n    field: string;\n    route?: string;\n    type: {new(...args: any[]): T};\n    fetch?: TFetchMode;\n    async?: boolean;\n}\n\nexport function HasMany<T = any>(\n    field: string | HasManyConfig,\n    type?: {new(...args: any[]): T},\n    fetch?: TFetchMode,\n    route?: string,\n    async?: boolean\n): any {\n    let config: HasManyConfig;\n    if (typeof field === 'object') {\n        config = {\n            type: field.type,\n            route: field.route || field.field,\n            fetch: field.fetch || FetchMode.LAZY,\n            async: !!field.async,\n            field: field.field\n        };\n    } else {\n        config = {\n            route: route || field,\n            fetch: fetch || FetchMode.LAZY,\n            async: !!async,\n            type: type,\n            field: field\n        };\n    }\n    config.async = config.fetch === FetchMode.LAZY || config.async;\n\n    return function <T extends {new(...args: any[]): {}}>(target: T, propertyKey: string) {\n        if (typeof target !== 'function') {\n            throw new Error(\n                'HasMany decorator should be applied on the class and not on the property!' +\n                ` Class: ${getClassName(target)}, property: ${propertyKey}`\n            );\n        }\n\n        if (!RestModel.isPrototypeOf(target)) {\n            throw new Error(\n                'HasMany decorator should be applied on a class that extends RestModel!' +\n                ` But ${getClassName(target)} is not extending it.`\n            );\n        }\n\n        if (!config.type) {\n            throw new Error(\n                `HasMany: The type should be specified!` +\n                ` Class: ${getClassName(target)}, field: ${config.field}`\n            );\n        }\n\n        return class extends target {\n            get [config.field]() {\n                return this['$hasMany'][config.field].list;\n            }\n\n            set [config.field](items: any[]) {\n                this['$hasMany'][config.field].setList(items);\n            }\n\n            constructor(...args: any[]) {\n                super(...args);\n                const $hasMany = this['$hasMany'];\n                $hasMany[config.field] = new HasManyHandler(<any>this, config);\n            }\n        };\n    };\n}\n"]}